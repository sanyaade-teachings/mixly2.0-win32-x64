/*! For license information please see index.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],t);else{var n="object"==typeof exports?t(require("blockly/core")):t(e.Blockly);for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(this,(e=>(()=>{"use strict";var t={573:t=>{t.exports=e}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{i.r(r),i.d(r,{DEFAULT_HEIGHT:()=>p,DEFAULT_WIDTH:()=>y});var e=i(573),t=i.n(e);function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(){return s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=c(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},s.apply(this,arguments)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function h(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}var p=5,y=5,v=15,_="#363d80",g="white",b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(m,e);var n,i,r,l,c,b=(l=m,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=d(l);if(c){var n=d(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return h(this,e)});function m(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return a(this,m),null!==(e=b.call(this,t,n,i)).getValue()?(e.imgHeight_=e.getValue().length,e.imgWidth_=e.getValue()[0].length||0):(e.imgHeight_=i&&i.height||p,e.imgWidth_=i&&i.width||y),null===e.getValue()&&e.setValue(e.getEmptyArray_()),e.boundEvents_=[],e.editorPixels_=null,e.fieldGroup_=null,e.blockDisplayPixels_=null,e.mouseIsDown_=!1,e.valToPaintWith_=void 0,e}return n=m,i=[{key:"getImageWidth",value:function(){return this.imgWidth_}},{key:"getImageHeight",value:function(){return this.imgHeight_}},{key:"doClassValidation_",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!e)return null;if(!Array.isArray(e))return null;var t=e.length;if(0==t)return null;var n,i=e[0].length,r=o(e);try{for(r.s();!(n=r.n()).done;){var l=n.value;if(!Array.isArray(l))return null;if(l.length!==i)return null}}catch(e){r.e(e)}finally{r.f()}var a,u=o(e);try{for(u.s();!(a=u.n()).done;){var s,c=a.value,f=o(c);try{for(f.s();!(s=f.n()).done;){var h=s.value;if(0!==h&&1!==h)return null}}catch(e){f.e(e)}finally{f.f()}}}catch(e){u.e(e)}finally{u.f()}return e}},{key:"doValueUpdate_",value:function(e){if(s(d(m.prototype),"doValueUpdate_",this).call(this,e),e){var t=e.length,n=e[0]?e[0].length:0;this.imgHeight_===t&&this.imgWidth_===n||(this.imgHeight_=t,this.imgWidth_=n),this.imgHeight_=e.length,this.imgWidth_=e[0]?e[0].length:0}}},{key:"showEditor_",value:function(){var e=this.dropdownCreate_();t().DropDownDiv.getContentDiv().appendChild(e),t().DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this))}},{key:"render_",value:function(){var e=this;s(d(m.prototype),"render_",this).call(this),this.getValue()&&this.blockDisplayPixels_&&this.forAllCells_((function(t,n){var i=e.getValue()[t][n];e.blockDisplayPixels_&&(e.blockDisplayPixels_[t][n].style.fill=i?_:g),e.editorPixels_&&(e.editorPixels_[t][n].style.background=i?_:g)}))}},{key:"updateEditable",value:function(){return!0}},{key:"dropdownCreate_",value:function(){var e=this,t=this.createElementWithClassname_("div","dropdownEditor"),n=this.createElementWithClassname_("div","pixelContainer");t.appendChild(n),this.bindEvent_(t,"mouseup",this.onMouseUp_),this.bindEvent_(t,"mouseleave",this.onMouseUp_),this.bindEvent_(t,"dragstart",(function(e){e.preventDefault()})),this.editorPixels_=[];for(var i=function(t){e.editorPixels_.push([]);for(var i=e.createElementWithClassname_("div","pixelRow"),r=function(n){var r=e.createElementWithClassname_("div","pixelButton");e.editorPixels_[t].push(r),i.appendChild(r);var o=e.getValue()[t][n];r.style.background=o?_:g,e.bindEvent_(r,"mousedown",(function(){return e.onMouseDownInPixel_(t,n),!0})),e.bindEvent_(r,"mouseenter",(function(){e.onMouseEnterPixel_(t,n)}))},o=0;o<e.imgWidth_;o++)r(o);n.appendChild(i)},r=0;r<this.imgHeight_;r++)i(r);return this.addControlButton_(t,"随机",this.randomizePixels_),this.addControlButton_(t,"清空",this.clearPixels_),this.blockDisplayPixels_&&this.forAllCells_((function(t,n){var i=e.getValue()[t][n];e.editorPixels_&&(e.editorPixels_[t][n].style.background=i?_:g)})),t}},{key:"initView",value:function(){this.blockDisplayPixels_=[];for(var e=0;e<this.imgHeight_;e++){for(var n=[],i=0;i<this.imgWidth_;i++){var r=t().utils.dom.createSvgElement("rect",{x:i*v,y:e*v,width:v,height:v,fill:g,fill_opacity:1},this.fieldGroup_);n.push(r)}this.blockDisplayPixels_.push(n)}}},{key:"updateSize_",value:function(){var e=v*this.imgWidth_,t=v*this.imgHeight_;this.borderRect_&&(this.borderRect_.setAttribute("width",String(e)),this.borderRect_.setAttribute("height",String(t))),this.size_.width=e,this.size_.height=t}},{key:"addControlButton_",value:function(e,t,n){var i=this.createElementWithClassname_("button","controlButton");i.innerHTML=t,e.appendChild(i),this.bindEvent_(i,"click",n)}},{key:"dropdownDispose_",value:function(){var e,n=o(this.boundEvents_);try{for(n.s();!(e=n.n()).done;){var i=e.value;t().browserEvents.unbind(i)}}catch(e){n.e(e)}finally{n.f()}this.editorPixels_=null}},{key:"getEmptyArray_",value:function(){for(var e=[],t=0;t<this.imgHeight_;t++){e.push([]);for(var n=0;n<this.imgWidth_;n++)e[t].push(0)}return e}},{key:"onMouseDownInPixel_",value:function(e,t){var n=1-this.getValue()[e][t];this.setPixel_(e,t,n),this.mouseIsDown_=!0,this.valToPaintWith_=n}},{key:"onMouseEnterPixel_",value:function(e,t){this.mouseIsDown_&&this.getValue()[e][t]!==this.valToPaintWith_&&this.setPixel_(e,t,this.valToPaintWith_)}},{key:"onMouseUp_",value:function(){this.mouseIsDown_=!1,this.valToPaintWith_=void 0}},{key:"randomizePixels_",value:function(){var e=this.getEmptyArray_();this.forAllCells_((function(t,n){e[t][n]=Math.floor(2*Math.random())})),this.setValue(e)}},{key:"clearPixels_",value:function(){var e=this.getEmptyArray_();this.forAllCells_((function(t,n){e[t][n]=0})),this.setValue(e)}},{key:"setPixel_",value:function(e,t,n){var i=JSON.parse(JSON.stringify(this.getValue()));i[e][t]=n,this.setValue(i)}},{key:"forAllCells_",value:function(e){for(var t=0;t<this.imgHeight_;t++)for(var n=0;n<this.imgWidth_;n++)e(t,n)}},{key:"createElementWithClassname_",value:function(e,t){var n=document.createElement(e);return n.className=t,n}},{key:"bindEvent_",value:function(e,n,i){this.boundEvents_.push(t().browserEvents.conditionalBind(e,n,this,i))}}],r=[{key:"fromJson",value:function(e){return new m(e&&e.value,void 0,e)}}],i&&u(n.prototype,i),r&&u(n,r),Object.defineProperty(n,"prototype",{writable:!1}),m}(t().Field);b.prototype.SERIALIZABLE=!0,Object.defineProperty(t(),"FieldBitmap",{value:b,writable:!0,enumerable:!0,configurable:!0}),t().fieldRegistry.register("field_bitmap",t().FieldBitmap),t().Css.register([".dropdownEditor {\n        align-items: center;\n        flex-direction: column;\n        display: flex;\n        justify-content: center;\n        margin-bottom: 20px;\n      }\n  .pixelContainer {\n    margin: 20px;\n  }\n  .pixelRow {\n    display: flex;\n    flex-direction: row;\n    padding: 0;\n    margin: 0;\n    height: ".concat(v,"\n  }\n  .pixelButton {\n    width: ").concat(v,"px;\n    height: ").concat(v,"px;\n    border: 1px solid black;\n  }\n  .pixelDisplay {\n    white-space:pre-wrap;\n  }\n  .controlButton {\n    margin: 5px 0;\n  }")])})(),r})()));